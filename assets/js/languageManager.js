// Centralized translations for English and Spanish
window.translations = {
  en: {
    // Navigation
    "nav_about": "About",
    "nav_projects": "Projects",
    "nav_skills": "Skills",
    "nav_contact": "Contact",
    "nav_cv": "CV",
    
    // Hero Section
    "hero_greeting_initial": "Hi!",
    "hero_greeting_intro": "This is Miguel:",
    "hero_greeting_jobSearch": "He is looking for his first IT job!",
    "hero_greeting_scholarship": "and he's got a 3 months Full Scholarship for that",
    "hero_greeting_callToAction": "find out more down below...",
    "hero_greeting_welcome": "Welcome!",
    "hero_quote": "The mind is a LEGO set waiting for its model.",
    "hero_role": "Data Enthusiast & Machine-Learning Explorer",
    
    // Quotes from quotes.json - for quote rotation
    "quotes": [
      "I study with the tools of the future to earn my place in the present.",
      "The classroom has always been my habitat. It's where I breathe best.",
      "Technology, like art, flourishes when its creator lives broadly.",
      "If I can recognize a LEGO piece instantly, can a machine learn to do the same?",
      "What I offer isn't just knowledge—I offer direction, enthusiasm, and a grounded will to grow."
    ],
    
    // About Section
    "about_title": "Bio",
    "role_models_title": "Role Models",
    "bio_listen": "Listen to this intro",
    "bio_speed": "x1",
    "bio_subtitle": "Also available as podcast (o˘◡˘o)",
    "peekingCharacter": "( ͡ᵔ ͜ʖ ͡ᵔ) If I had a photo of all the teachers I've had in my life, they would go here.",
    
    // Projects Section
    "projects_title": "Current Projects",
    "lego_project_title": "Brickssifier Studwise",
    "lego_project_desc": "LEGO Bricks Classification pipeline",
    "lego_project_status": "DEMO Available Now!",
    "flowloops_title": "FlowLoops",
    "flowloops_desc": "TimeTeller productivity WebApp",
    "flowloops_status": "DEMO Available Now!",
    "podcast_title": "CoffeeBreak Podcast Database",
    "podcast_desc": "WebScrapping, Language Processing, SQL Database project",
    "beca_title": "Tengo una Beca!",
    "beca_desc": "infórmate AQUI",
    "ai_title": "How do I make use of AI?",
    "ai_desc": "... everyone wants to know!",
    
    // Skills Section
    "skills_title": "Skills",
    "skills_note": "*Skill I aim to develop",
    
    // Contact Section
    "contact_thanks": "Thanks for reading!",
    "contact_line1": "We humans grow with each conversation... reach out!",
    "contact_line2": "Si mi historia resonó contigo... hablemos!",
    "contact_cta": "Let's connect and create something amazing together!",
    "contact_role": "Data Enthusiast & ML Explorer",
    "contact_form_title": "Share your thoughts",
    "contact_form_desc": "Send advice, encouragement, or feedback – anything that could help me grow!",
    "contact_form_name": "Name",
    "contact_form_message": "Message",
    "contact_form_placeholder": "What would you like to say?",
    "contact_form_send": "Send"
  },
  es: {
    // Navigation
    "nav_about": "Bio",
    "nav_projects": "Proyectos",
    "nav_skills": "Habilidades",
    "nav_contact": "Contacto",
    "nav_cv": "CV",
    
    // Hero Section
    "hero_greeting_initial": "¡Hola!",
    "hero_greeting_intro": "Este es Miguel:",
    "hero_greeting_jobSearch": "¡Está buscando su primer trabajo en IT!",
    "hero_greeting_scholarship": "y él tiene una Beca Completa de 3 meses para ello",
    "hero_greeting_callToAction": "infórmate en la sección de Proyectos, abajo.",
    "hero_greeting_welcome": "Se bienvenido...",
    "hero_quote": "La mente es un set de LEGO esperando su modelo.",
    "hero_role": "Entusiasta de Datos y Explorador de Machine Learning",
    
    // Quotes from quotes.json - Spanish translations
    "quotes": [
      "Estudio con las herramientas del futuro para ganarme mi lugar en el presente.",
      "El aula siempre ha sido mi hábitat. Es donde respiro mejor.",
      "La tecnología, como el arte, florece cuando su creador vive ampliamente.",
      "Si puedo reconocer una pieza de LEGO instantáneamente, ¿puede una máquina aprender a hacer lo mismo?",
      "Lo que ofrezco no es solo conocimiento—ofrezco dirección, entusiasmo y una voluntad firme de crecer."
    ],
    
    // About Section
    "about_title": "Biografía",
    "role_models_title": "Me inspiran",
    "bio_listen": "Escucha esta intro (en inglés)",
    "bio_speed": "x1",
    "bio_subtitle": "(En inglés) También disponible como podcast (o˘◡˘o)",
    "peekingCharacter": "( ͡ᵔ ͜ʖ ͡ᵔ) Si tuviera una foto de todos los maestros que he tenido en mi vida, estarían aquí.",
    
    // Projects Section
    "projects_title": "Proyectos Actuales",
    "lego_project_title": "Brickssifier Studwise",
    "lego_project_desc": "Pipeline de clasificación de piezas LEGO",
    "lego_project_status": "¡DEMO Disponible Ahora!",
    "flowloops_title": "FlowLoops",
    "flowloops_desc": "WebApp de productividad TimeTeller",
    "flowloops_status": "¡DEMO Disponible Ahora!",
    "podcast_title": "Base de Datos de Podcast CoffeeBreak",
    "podcast_desc": "Proyecto de WebScrapping, Procesamiento de Lenguaje y Base de Datos SQL",
    "beca_title": "¡Tengo una Beca!",
    "beca_desc": "infórmate AQUI",
    "ai_title": "¿Cómo utilizo la IA?",
    "ai_desc": "... todos queremos saber!",
    
    // Skills Section
    "skills_title": "Habilidades",
    "skills_note": "*Habilidad que aspiro a desarrollar",
    
    // Contact Section
    "contact_thanks": "¡Gracias por leer!",
    "contact_line1": "Los humanos crecemos con cada conversación... ¡comunícate!",
    "contact_line2": "If my story resonated with you... let's talk!",
    "contact_cta": "¡Conectemos y creemos algo increíble juntos!",
    "contact_role": "Entusiasta de Datos y Explorador de ML",
    "contact_form_title": "Comparte tus ideas",
    "contact_form_desc": "Envía consejos, palabras de aliento o feedback – ¡cualquier cosa que me ayude a crecer!",
    "contact_form_name": "Nombre",
    "contact_form_message": "Mensaje",
    "contact_form_placeholder": "¿Qué te gustaría decir?",
    "contact_form_send": "Enviar"
  }
};

// Initialize language with auto-detection
function initializeLanguage() {
  // 1. Check localStorage first
  const savedLang = localStorage.getItem('preferredLanguage');
  
  // 2. If no saved preference, detect browser language
  if (!savedLang) {
    const browserLang = navigator.language || navigator.userLanguage;
    currentLanguage = browserLang.startsWith('es') ? 'es' : 'en';
  } else {
    currentLanguage = savedLang;
  }
  
  // 3. Apply language and update UI
  applyLanguage(currentLanguage);
  updateLanguageToggle(currentLanguage);
}

// Change language function
function changeLanguage(lang) {
  if (lang === currentLanguage || !window.translations[lang]) return;
  
  currentLanguage = lang;
  applyLanguage(lang);
  updateLanguageToggle(lang);
  
  // Store preference
  localStorage.setItem('preferredLanguage', lang);
}

// Apply translations efficiently
function applyLanguage(lang) {
  if (!window.translations[lang]) return;
  
  // Use requestAnimationFrame for smoother UI updates
  requestAnimationFrame(() => {
    // Text content
    document.querySelectorAll('[data-i18n]').forEach(element => {
      const key = element.getAttribute('data-i18n');
      if (window.translations[lang][key]) {
        element.textContent = window.translations[lang][key];
      }
    });
    
    // Attributes (placeholder, title, aria-label, etc)
    document.querySelectorAll('[data-i18n-attr]').forEach(element => {
      const [attr, key] = element.getAttribute('data-i18n-attr').split(':');
      if (window.translations[lang][key]) {
        element.setAttribute(attr, window.translations[lang][key]);
      }
    });
    
    // HTML content (for elements with formatted content)
    document.querySelectorAll('[data-i18n-html]').forEach(element => {
      const key = element.getAttribute('data-i18n-html');
      if (window.translations[lang][key]) {
        element.innerHTML = window.translations[lang][key];
      }
    });
    
    // Update document language
    document.documentElement.lang = lang;
    
    // Special elements handling
    handleSpecialElements(lang);
  });
}

// Update language toggle UI
function updateLanguageToggle(lang) {
  const enButton = document.getElementById('lang-en');
  const esButton = document.getElementById('lang-es');
  const enButtonMobile = document.getElementById('lang-en-mobile');
  const esButtonMobile = document.getElementById('lang-es-mobile');
  
  // Desktop buttons
  if (enButton && esButton) {
    // Reset both buttons
    enButton.classList.remove('bg-gray-200', 'font-medium');
    esButton.classList.remove('bg-gray-200', 'font-medium');
    
    // Highlight active language
    if (lang === 'en') {
      enButton.classList.add('bg-gray-200', 'font-medium');
    } else {
      esButton.classList.add('bg-gray-200', 'font-medium');
    }
  }
  
  // Mobile buttons
  if (enButtonMobile && esButtonMobile) {
    // Reset both buttons
    enButtonMobile.classList.remove('bg-gray-200', 'font-medium');
    esButtonMobile.classList.remove('bg-gray-200', 'font-medium');
    
    // Highlight active language
    if (lang === 'en') {
      enButtonMobile.classList.add('bg-gray-200', 'font-medium');
    } else {
      esButtonMobile.classList.add('bg-gray-200', 'font-medium');
    }
  }
}

// Handle special elements like typewriter
function handleSpecialElements(lang) {
  // Restart typewriter animation with new language
  if (window.initTypewriter) {
    window.initTypewriter(lang);
  }
  
  // Update quotes rotation if active
  if (window.updateQuoteRotation) {
    window.updateQuoteRotation(lang);
  }
}

// Get quotes for current language
function getQuotes(lang = currentLanguage) {
  return window.translations[lang]?.quotes || window.translations['en'].quotes;
}

// Make functions available globally
window.changeLanguage = changeLanguage;
window.getQuotes = getQuotes;

// Current language tracking
let currentLanguage = 'en';

// Initialize when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  initializeLanguage();
});